---
lab:
  title: 'ラボ: AVD (AD DS) に対する条件付きアクセス ポリシーを構成する'
  module: 'Module 3: Manage Access and Security'
---

# ラボ - AVD (AD DS) に対する条件付きアクセス ポリシーを構成する
# 受講生用ラボ マニュアル

## ラボの依存関係

- Azure サブスクリプション
- Azure サブスクリプションに関連付けられた Microsoft Entra テナントの全体管理者ロールと、Azure サブスクリプションの所有者または共同作成者ロールを持つ Microsoft アカウントまたは Microsoft Entra アカウント
- 完了したラボ: **Azure Virtual Desktop (AD DS) のデプロイを準備する**
- 完了したラボ **Azure portal を使用してホスト プールとセッション ホストをデプロイする (AD DS)**

## 推定所要時間

60 分

## ラボのシナリオ

Microsoft Entra 条件付きアクセスを使用して、Active Directory Domain Services (AD DS) 環境での Azure Virtual Desktop のデプロイへのアクセスを制御する必要があります。

## 目標
  
このラボを完了すると、次のことができるようになります。

- Azure Virtual Desktop の Microsoft Entra ベースの条件付きアクセスを準備する
- Azure Virtual Desktop の Microsoft Entra ベースの条件付きアクセスを実装する

## ラボ ファイル

- なし 

## 手順

### 演習 1: Azure Virtual Desktop の Microsoft Entra ベースの条件付きアクセスを準備する

この演習の主なタスクは次のとおりです。

1. Microsoft Entra Premium P2 ライセンスを設定する
1. Microsoft Entra 多要素認証 (MFA) を構成する
1. Microsoft Entra MFA のユーザーを登録する
1. ハイブリッド Microsoft Entra 参加を構成する
1. Microsoft Entra Connect の差分同期をトリガーする

#### タスク 1: Microsoft Entra Premium P2 ライセンスを構成する

>**注**: Microsoft Entra 条件付きアクセスを実装するには、Microsoft Entra の Premium P1 または P2 のライセンスが必要です。 このラボでは、30 日間の試用版を使用します。

1. ラボのコンピューターで Web ブラウザーを起動し、[Azure portal](https://portal.azure.com) に移動して、このラボで使用するサブスクリプションの所有者ロールと、サブスクリプションに関連付けられている Microsoft Entra テナントのグローバル管理者ロールを持つユーザー アカウントの資格情報を指定してサインインします。
1. Azure portal で **Azure Active Directory** を検索して選択し、このラボで使用している Azure サブスクリプションに関連付けられている Microsoft Entra テナントに移動します。
1. [Azure Active Directory] ブレードの左側にある垂直方向のメニューバーの **[管理]** セクションで、**[ユーザー]** をクリックします。 
1. **[ユーザー | すべてのユーザー (プレビュー)]** ウィンドウで、**[aduser5]** を選択します。
1. **[aduser5 | プロファイル]** ウィンドウのツール バーで、**[編集]** をクリックし、**[設定]** セクションの **[使用場所]** ドロップダウン リストで、ラボ環境が配置されている国を選択し、ツール バーで **[保存]** をクリックします。
1. **[aduser5 | プロファイル]** ウィンドウの **[ID]** セクションで、**aduser5** アカウントのユーザー プリンシパル名を識別します。

    >**注**:この値は記録しておいてください。 このラボで後ほど必要になります。

1. **[ユーザー | すべてのユーザー (プレビュー)]** ウィンドウで、このタスクの開始時に署名に使用したユーザー アカウントを選択し、アカウントに **[使用場所]** が割り当てられていない場合は、前の手順を繰り返します。 

    >**注**: Microsoft Entra Premium P2 ライセンスをユーザー アカウントに割り当てるには、**利用場所**のプロパティを設定する必要があります。

1. **[ユーザー | すべてのユーザー (プレビュー)]** ウィンドウで、**[aadsyncuser]** ユーザー アカウントを選択し、そのユーザー プリンシパル名を識別します。

    >**注**:この値は記録しておいてください。 このラボで後ほど必要になります。

1. Azure portal で、Microsoft Entra テナントの **[概要]** ブレードに戻り、左側の垂直方向のメニュー バーの **[管理]** セクションで、**[ライセンス]** をクリックします。
1. **[ライセンス \| 概要]** ウィンドウの左側の垂直メニューにある **[管理]** セクションで、**[すべての製品]** をクリックします。
1. **[ライセンス \| すべての製品]** ウィンドウのツールバーで、**[+ 試用/購入]** をクリックします。
1. **[アクティブ化]** ブレードの **[ENTERPRISE MOBILITY + SECURITY E5]** セクションで、**[無料試用版]** をクリックし、**[アクティブ化]** をクリックします。 
1. **[ライセンス \| 概要]** ウィンドウで、ブラウザー ウィンドウを更新して、ライセンス認証が成功したことを確認します。 
1. **[ライセンス - すべての製品]** ブレードで、**[Enterprise Mobility + Security E5]** エントリを選択します。 
1. **[Enterprise Mobility + Security E5]** ブレードのツール バーで、**[+ 割り当て]** をクリックします。
1. **[ライセンスの割り当て]** ウィンドウで、**[ユーザーとグループの追加]** をクリックし、**[ユーザーとグループの追加]** ウィンドウで、**[aduser5]** とお使いのユーザー アカウントを選択して、**[選択]** をクリックします。
1. **[ライセンスの割り当て]** ブレードに戻り、**[割り当てオプション]** をクリックし、**[割り当てオプション]** ブレードで、すべてのオプションが有効になっていることを確認し、**[レビュー + 割り当て]** をクリックし、**[割り当て]** をクリックします。

#### タスク 2: Microsoft Entra 多要素認証 (MFA) を構成する

1. ラボのコンピューターの Azure portal が表示されている Web ブラウザーで、Microsoft Entra テナントの **[概要]** ブレードに戻り、左側の垂直方向のメニューの **[管理]** セクションで **[セキュリティ]** をクリックします。
1. **[セキュリティ | 概要]** ウィンドウの左側の垂直メニューにある **[保護]** セクションで、**[ID 保護]** をクリックします。
1. **[ID 保護 | 概要]** ウィンドウの左側の垂直メニューにある **[保護]** セクションで、**[多要素認証登録ポリシー]** をクリックします (必要に応じて、Web ブラウザー ページを更新します)。
1. **[ID 保護 | 多要素認証登録ポリシー]** ウィンドウの **[多要素認証登録ポリシー]** の **[割り当て]** セクションで、**[すべてのユーザー]** をクリックし、**[含める]** タブで **[個人とグループの選択]** オプションをクリックし、**[ユーザーの選択]** で **[aduser5]** をクリックし、ウィンドウの下部にある **[選択]** をクリックして、**[ポリシーの適用]** スイッチを **[オン]** に設定し、**[保存]** をクリックします。

#### タスク 3: Microsoft Entra MFA のユーザーを登録する

1. ラボ コンピューターで、**InPrivate** Web ブラウザー セッションを開き、[Azure portal](https://portal.azure.com) に移動し、この演習で先ほど特定した **aduser5** ユーザー プリンシパル名と、このユーザー アカウントの作成時に設定したパスワードを入力してサインインします。
1. "**詳細情報が必要です**" というメッセージが表示されたら、**[次へ]** をクリックします。 これにより、ブラウザーが **「Microsoft Authenticator」** ページに自動的にリダイレクトされます。
1. **「追加のセキュリティ確認」** ページの **[手順 1: 連絡方法]** セクションで、優先する認証方法を選択し、手順に従って登録プロセスを完了します。 
1. 「Azure portal」ページの右上隅にあるユーザー アバターを表すアイコンをクリックし、**[サインアウト]** をクリックして、**[In private]** ブラウザー ウィンドウを閉じます。 

#### タスク 4: ハイブリッド Microsoft Entra 参加を構成する

> **注**: この機能を利用して、Microsoft Entra 参加状態に基づいてデバイスの条件付きアクセスを設定するときに、追加のセキュリティを実装できます。

1. ラボ コンピューターの Azure portal が表示されている Web ブラウザーで、「**仮想マシン**」を検索して選択し、**[仮想マシン]** ブレードから **az140-dc-vm11** を選択します。
1. **[az140-dc-vm11]** ウィンドウで **[接続]** を選択し、ドロップダウン メニューで **[Bastion]** を選択し、**[az140-dc-vm11 \| 接続]** ウィンドウの **[Bastion]** タブで **[Bastion を使用する]** を選択します。
1. プロンプトが表示されたら、次の資格情報を入力し、**[接続]** を選択します。

   |設定|値|
   |---|---|
   |[ユーザー名]|**Student**|
   |パスワード|**Pa55w.rd1234**|

1. **az140-dc-vm11** への Bastion セッション内の **[スタート]** メニューで、**Microsoft Entra Connect** フォルダーを展開し、**Microsoft Entra Connect** を選択します。
   > **注** "同期サービスが実行されていません" という失敗エラー ウィンドウが表示された場合は、PowerShell コマンド ウィンドウに移動して、「**Start-Service "ADSync"**」と入力し、手順 4 をもう一度試行します。
1. **[Microsoft Entra Connect]** ウィンドウの **「Microsoft Entra Connect へようこそ」** ページで、**[構成]** を選択します。
1. **[Microsoft Entra Connect]** ウィンドウの **「追加のタスク」** ページで、**[デバイス オプションの構成]** を選択し、**[次へ]** を選択します。
1. **[Microsoft Entra Connect]** ウィンドウの **「概要」** ページで、**ハイブリッド Microsoft Entra 参加**と**デバイス ライトバック**に関する情報を確認し、**[次へ]** を選択します。
1. **[Microsoft Entra Connect]** ウィンドウの **「Connect to Microsoft Entra」** ページで、前の演習で作成した **aadsyncuser** ユーザー アカウントの資格情報を使用して認証し、**[次へ]** を選択します。  

   > **注**: このラボで先ほど記録した **aadsyncuser** アカウントの userPrincipalName 属性を指定し、このユーザー アカウントの作成時に設定したパスワードを指定します。 

1. **[Microsoft Entra Connect]** ウィンドウの **「デバイス オプション」** ページで、**[ハイブリッド Microsoft Entra 参加の構成]** オプションが選択されていることを確認し、**[次へ]** を選択します。 
1. **[Microsoft Entra Connect]** ウィンドウの **「デバイス オペレーティング システム」** ページで、**[Windows 10 以降のドメイン参加済みデバイス]** チェックボックスを選択し、**[次へ]** を選択します。 
1. **[Microsoft Entra Connect]** ウィンドウの **「SCP 構成」** ページで、**adatum.com** エントリの横にあるチェックボックスを選択し、**[認証サービス]** ドロップダウン リストで **[Microsoft Entra]** エントリを選択し、**[追加]** を選択します。 
1. メッセージが表示されたら、**[エンタープライズ管理者の資格情報]** ダイアログ ボックスで、次の資格情報を指定し、**[OK]** を選択します。

   |設定|値|
   |---|---|
   |ユーザー名|**ADATUM\Student**|
   |パスワード|**Pa55w.rd1234**|

1. **[Microsoft Entra Connect]** ウィンドウの **「SCP 構成」** ページに戻り、**[次へ]** を選択します。
1. **[Microsoft Entra Connect]** ウィンドウの **「構成の準備完了」** ページで、**[構成]** を選択し、構成が完了したら **[終了]** を選択します。
1. **az140-dc-vm11** への Bastion セッション内で、**Windows PowerShell ISE** を管理者としてを起動します。
1. **az140-dc-vm11** への Bastion セッション内で、**[Administrator: Windows PowerShell ISE]** コンソールから、次を実行して、**az140-cl-vm11** コンピューター アカウントを **WVDClients** 組織単位 (OU) に移動します。

   ```powershell
   Move-ADObject -Identity "CN=az140-cl-vm11,CN=Computers,DC=adatum,DC=com" -TargetPath "OU=WVDClients,DC=adatum,DC=com"
   ```

1. **az140-dc-vm11** への Bastion セッション内の **[スタート]** メニューで、**Microsoft Entra Connect** フォルダーを展開し、**Microsoft Entra Connect** を選択します。
1. **[Microsoft Entra Connect]** ウィンドウの **「Microsoft Entra Connect へようこそ」** ページで、**[構成]** を選択します。
1. **[Microsoft Entra Connect]** ウィンドウの **「追加のタスク」** ページで、**[同期オプションをカスタマイズする]** を選択し、**[次へ]** を選択します。
1. **[Microsoft Entra Connect]** ウィンドウの **「Connect to Microsoft Entra」** ページで、前の演習で作成した **aadsyncuser** ユーザー アカウントの資格情報を使用して認証し、**[次へ]** を選択します。 

   > **注**: このラボで先ほど記録した **aadsyncuser** アカウントの userPrincipalName 属性を指定し、このユーザー アカウントの作成時に設定したパスワードを指定します。 

1. **[Microsoft Entra Connect]** ウィンドウの **「ディレクトリの接続」** ページで、**[次へ** を選択します。
1. **[Microsoft Entra Connect]** ウィンドウの **「ドメインと OU のフィルタリング」** ページで、**[選択したドメインと OU を同期する]** オプションが選択されていることを確認し、**adatum.com** ノードを展開して、**ToSync OU** の横にあるチェックボックスが選択されていることを確認し、**WVDClients** OU の横にあるチェックボックスを選択して、**[次へ]** を選択します。
1. **[Microsoft Entra Connect]** ウィンドウの **「オプション機能」** ページで、既定の設定をそのまま使用して、**[次へ]** を選択します。
1. **[Microsoft Entra Connect]** ウィンドウの **「構成の準備完了」** ページで、**[構成が完了したら、同期プロセスを開始してください]** チェックボックスが選択されていることを確認し、**[構成]** を選択します。
1. **「構成が完了しました」** ページの情報を確認し、**[終了]** を選択して、**[Mcrosoft Entra Connect]** ウィンドウを閉じます。

#### タスク 5: Microsoft Entra Connect の差分同期をトリガーする

1. **az140-dc-vm11** への Bastion セッション内で、**[Administrator: Windows PowerShell ISE]** ウィンドウに切り替えます。
1. **az140-dc-vm11** への Bastion セッション内で、**[Administrator: Windows PowerShell ISE]** コンソールから次を実行して、Microsoft Entra Connect の差分同期をトリガーします。

   ```powershell
   Import-Module -Name "C:\Program Files\Microsoft Azure AD Sync\Bin\ADSync"
   Start-ADSyncSyncCycle -PolicyType Initial
   ```

1. **az140-dc-vm11** への Bastion セッション内で、Microsoft Edge を起動して、[Azure portal](https://portal.azure.com) に移動します。 メッセージが表示されたら、このラボで使用している Azure サブスクリプションに関連付けられている Microsoft Entra テナントのグローバル管理者ロールを持つユーザー アカウントの Microsoft Entra 資格情報を使用してサインインします。
1. **az140-dc-vm11** への Bastion セッション内において、Azure portal が表示されている [Microsoft Edge] ウィンドウで、**「Azure Active Directory」** を検索して選択し、このラボに使用している Azure サブスクリプションに関連付けられている Microsoft Entra テナントに移動します。
1. [Azure Active Directory] ブレードの左側にある垂直方向のメニュー バーの **[管理]** セクションで、**[デバイス]** をクリックします。 
1. **[デバイス | すべてのデバイス]** ブレードで、デバイスの一覧を確認し、**az140-cl-vm11** デバイスが **[参加の種類]** 列の **[ハイブリッド Microsoft Entra 参加済み]** エントリに一覧表示されていることを確認します。

   > **注**: デバイスが Azure portal に表示されるには、同期が有効になるまで数分待つ必要がある場合があります。

### 演習 2: Azure Virtual Desktop の Microsoft Entra ベースの条件付きアクセスを実装する

この演習の主なタスクは次のとおりです。

1. すべての Azure Virtual Desktop 接続に対して Microsoft Entra ベースの条件付きアクセス ポリシーを作成する
1. すべての Azure Virtual Desktop 接続に対して Microsoft Entra ベースの条件付きアクセス ポリシーをテストする
1. Microsoft Entra ベースの条件付きアクセス ポリシーを変更して、ハイブリッド Microsoft Entra 参加済みコンピューターを MFA 要件から除外する
1. 変更された Microsoft Entra ベースの条件付きアクセス ポリシーをテストする

#### タスク 1: すべての Azure Virtual Desktop 接続に対して Microsoft Entra ベースの条件付きアクセス ポリシーを作成する

>**注**: このタスクでは、MFA が Azure Virtual Desktop セッションにサインインする必要がある Microsoft Entra ベースの条件付きアクセス ポリシーを構成します。 また、ポリシーは、認証が成功してから開始 4 時間後に再認証を適用します。

1. ラボのコンピューターの Azure portal が表示されている Web ブラウザーで、Microsoft Entra テナントの **[概要]** ブレードに戻り、左側の垂直方向のメニューの **[管理]** セクションで **[セキュリティ]** をクリックします。
1. **[セキュリティ \| 概要]** ウィンドウの左側の垂直メニューにある **[保護]** セクションで、**[条件付きアクセス]** をクリックします。
1. **[条件付きアクセス \| ポリシー]** ウィンドウで、ツール バーの **[+ 新しいポリシー]** をクリックします。
1. **新規**のブレードで、次の設定を構成します。

   - **[名前]** テキスト ボックスに「**az140-31-wvdpolicy1**」と入力します
   - **[割り当て]** セクションで **[ユーザーまたはワークロード ID]** オプションを選択し、**[このポリシーは何に適用されますか?]** ドロップダウン リストで **[ユーザーとグループ]** が選択されていることを確認し、**[ユーザーとグループの選択]** セクションで **[ユーザーとグループ]** チェックボックスをオンにし、**[選択]** ウィンドウで **[aduser5]** をクリックし、**[選択]** をクリックします。
   - **[割り当て]** セクションで、**[クラウド アプリまたはアクション]** をクリックし、**[このポリシーが適用される対象を選択する]** スイッチで **[クラウド アプリ]** オプションが選択されていることを確認し、**[アプリを選択]** オプションをクリックして、**[選択]** ウィンドウで **[検索]** テキストボックスに「**9cdead84-a844-4324-93f2-b2e6bb768d07**」と入力し、結果の一覧で **Azure Virtual Desktop** エントリの横にあるチェックボックスをオンにします。**[検索]** ボックスに「**a4a365df-50f1-4397-bc59-1a1564b8bb9c**」と入力し、**Microsoft リモート デスクトップ** エントリの横にあるチェックボックスをオンにして、**[選択]** をクリックします。 

   > **注**: Azure Virtual Desktop (アプリ ID 9cdead84-a844-4324-93f2-b2e6bb768d07) は、ユーザーがフィードをサブスクライブし、接続中に Azure Virtual Desktop ゲートウェイに対して認証するときに使用されます。 Microsoft リモート デスクトップ (アプリ ID a4a365df-50f1-4397-bc59-1a1564b8bb9c) は、シングル サインオンが有効になっているときにユーザーがセッション ホストに対して認証するときに使用されます。

   - **[割り当て]** セクションで、**[条件]** をクリックし、**[クライアント アプリ]** ブレードで **[クライアント アプリ]** をクリックし、**[構成]** スイッチを **[はい]** に設定し、**[ブラウザー]** と **[モバイル アプリとデスクトップ クライアント]** の両方のチェックボックスが選択されていることを確認して、**[完了]** をクリックします。
   - **[アクセス制御]** セクションで、**[許可]** をクリックし、**[許可]** ブレードで、**[アクセス許可]** オプションが選択されていることを確認し、**[多要素認証を要求する]** チェックボックスを選択し、**[選択]** をクリックします。
   - **[アクセス制御]** セクションで、**[セッション]** をクリックし、**[セッション]** ブレードの **[サインイン頻度]** チェックボックスを選択し、最初のテキストボックスに **「4」** と入力し、**[単位の選択]** ドロップダウン リストで **[時間]** を選択し、**[永続的なブラウザー セッション]** のチェックボックスをオフのままにして、**[選択]** をクリックします。
   - **[ポリシーの有効化]** スイッチを **[オン]** に設定します。

1. **[新規]** ブレードで **[作成]** をクリックします。 

#### タスク 2: すべての Azure Virtual Desktop 接続に対して Microsoft Entra ベースの条件付きアクセス ポリシーをテストする

1. ラボのコンピューターで、Azure portal を表示している Web ブラウザー ウィンドウで、**[Cloud Shell]** ペイン内の **PowerShell** シェル セッションを開きます。
1. [Cloud Shell] ペインの [PowerShell] セッションから、次を実行して、このラボで使用する Azure VM をホストする Azure Virtual Desktop セッションを開始します。

   ```powershell
   Get-AzVM -ResourceGroup 'az140-21-RG' | Start-AzVM
   ```

   >**注**: コマンドが完了し、**az140-21-RG** リソース グループ内のすべての Azure VM が実行されるまで待ちます。 

1. ラボ コンピューターで、**InPrivate** Web ブラウザー セッションを開き、[Azure portal](https://portal.azure.com) に移動し、この演習で先ほど特定した **aduser5** ユーザー プリンシパル名と、このユーザー アカウントの作成時に設定したパスワードを入力してサインインします。

   > **注**: MFA による認証を求められないことを確認します。

1. **InPrivate** Web ブラウザー セッションで、[https://rdweb.wvd.microsoft.com/arm/webclient](https://rdweb.wvd.microsoft.com/arm/webclient) の Azure Virtual Desktop HTML5 Web クライアント ページに移動します。

   > **注**: MFA を使用して認証が自動的にトリガーされることを確認します。

1. **[コードの入力]** ペインで、テキスト メッセージまたは登録した認証アプリのコードを入力し、**[検証]** を選択します。
1. **「すべてのリソース」** ページで、**[コマンド プロンプト]** をクリックし、**[ローカル リソースへのアクセス]** ペインで **[プリンター]** チェックボックスをオフにして、**[許可]** をクリックします。
1. プロンプトが表示されたら、**[資格情報の入力]** の **[ユーザー名]** テキストボックスに **aduser5** のユーザー プリンシパル名を入力し、**[パスワード]** テキストボックスに、このユーザー アカウントの作成時に設定したパスワードを入力して、**[送信]** をクリックします。
1. **コマンド プロンプト** リモート アプリが正常に起動されたことを確認します。
1. **コマンド プロンプト**の [リモート アプリ] ウィンドウにおいて、コマンド プロンプトで **「logoff」** と入力し、**Enter** キーを押します。
1. **「すべてのリソース」** ページに戻り、右上隅にある **[aduser5]** をクリックし、ドロップダウン メニューの **[サインアウト]** をクリックして、**InPrivate** Web ブラウザー ウィンドウを閉じます。

#### タスク 3: Microsoft Entra ベースの条件付きアクセス ポリシーを変更して、ハイブリッド Microsoft Entra 参加済みコンピューターを MFA 要件から除外する

>**注**: このタスクでは、Microsoft Entra 参加済みコンピューターからの接続で MFA が必要とされないように、AZURE Virtual Desktop セッションへのサインインに MFA を必要とする Microsoft Entra ベースの条件付きアクセス ポリシーを変更します。

1. ラボ コンピューターの Azure portal を表示しているブラウザー ウィンドウの **[条件付きアクセス | ポリシー]** ウィンドウで、**az140-31-wvdpolicy1** ポリシーを表すエントリをクリックします。
1. **[az140-31-wvdpolicy1]** ブレードの **[アクセス制御]** セクションの **[許可]** をクリックし、**[許可]** ブレードで、**[多要素認証を要求する]** と **[ハイブリッド Microsoft Entra 参加済みデバイスを要求する]** チェックボックスを選択し、**[選択したコントロールのいずれかを必須にする]** オプションが有効になっていることを確認して、**[選択]** をクリックします。
1. **[az140-31-wvdpolicy1]** ブレードで、**[保存]** をクリックします。

>**注**: ポリシーが有効になるまで数分かかる場合があります。

#### タスク 4: 変更された Microsoft Entra ベースの条件付きアクセス ポリシーをテストする

1. ラボのコンピューターから、Azure portal を表示しているブラウザー ウィンドウで、**「仮想マシン」** を検索して選択し、**[仮想マシン]** ブレードから **[az140-cl-vm11]** エントリを選択します。
1. **[az140-cl-vm11]** ウィンドウで **[接続]** を選択し、ドロップダウン メニューで **[Bastion]** を選択し、**[az140-cl-vm11 \| 接続]** ウィンドウの **[Bastion]** タブで **[Bastion を使用する]** を選択します。
1. プロンプトが表示されたら、次の資格情報を入力し、**[接続]** を選択します。

   |設定|値|
   |---|---|
   |ユーザー名|**Student@adatum.com**|
   |パスワード|**Pa55w.rd1234**|

1. **az140-cl-vm11** への Bastion セッション内で、Microsoft Edge を起動し、[https://rdweb.wvd.microsoft.com/arm/webclient](https://rdweb.wvd.microsoft.com/arm/webclient) にある Azure Virtual Desktop HTML5 Web クライアント ページに移動します。

   > **注**: 今回は、MFA による認証を求められないことを確認してください。 これは、**az140-cl-vm11** がハイブリッド Microsoft Entra 参加済みであるためです。

1. **[すべてのリソース]** ページで、**[コマンド プロンプト]** をダブルクリックし、**[ローカル リソースへのアクセス]** ウィンドウで **[プリンター]** チェックボックスをオフにして、**[許可]** をクリックします。
1. プロンプトが表示されたら、**[資格情報の入力]** の **[ユーザー名]** テキストボックスに **aduser5** のユーザー プリンシパル名を入力し、**[パスワード]** テキストボックスに、このユーザー アカウントの作成時に設定したパスワードを入力して、**[送信]** をクリックします。
1. **コマンド プロンプト** リモート アプリが正常に起動されたことを確認します。
1. **コマンド プロンプト**の [リモート アプリ] ウィンドウにおいて、コマンド プロンプトで **「logoff」** と入力し、**Enter** キーを押します。
1. **「すべてのリソース」** ページに戻り、右上隅にある **[aduser5]** をクリックし、ドロップダウン メニューの **[サインアウト]** をクリックします。
1. **az140-cl-vm11** への Bastion セッション内で、**[スタート]** をクリックし、**[スタート]** ボタンのすぐ上にある垂直方向のバーで、サインインしているユーザー アカウントを表すアイコンをクリックし、ポップアップ メニューで **[サインアウト]** をクリックします。

### 演習 3: ラボでプロビジョニングおよび使用されている Azure VM を停止して割り当てを解除する

この演習の主なタスクは次のとおりです。

1. ラボでプロビジョニングおよび使用されている Azure VM を停止して割り当てを解除する

>**注**: この演習では、関連するコンピューティング料金を最小限に抑えるために、このラボでプロビジョニングおよび使用されている Azure VM の割り当てを解除します

#### タスク 1: ラボでプロビジョニングおよび使用されている Azure VM の割り当てを解除する

1. ラボのコンピューターに切り替え、Azure portal が表示されている Web ブラウザー ウィンドウにおいて、**[Cloud Shell]** ペイン内で **[PowerShell]** シェル セッションを開きます。
1. [Cloud Shell] ウィンドウの PowerShell セッションから、次を実行して、このラボで作成および使用されているすべての Azure VM を一覧表示します。

   ```powershell
   Get-AzVM -ResourceGroup 'az140-21-RG'
   ```

1. [Cloud Shell] ウィンドウの PowerShell セッションから、次を実行して、このラボで作成および使用したすべての Azure VM を停止して割り当てを解除します。

   ```powershell
   Get-AzVM -ResourceGroup 'az140-21-RG' | Stop-AzVM -NoWait -Force
   ```

   >**注**: このコマンドは非同期で実行されるため (-NoWait パラメーターによって決定されます)、同じ PowerShell セッション内で直後に別の PowerShell コマンドを実行できますが、Azure VM が実際に停止されて割り当てが解除されるまでに数分かかります。
